<div class="grid-header">
  <input
    type="text"
    [placeholder]="'User.Search' | translate"
    [(ngModel)]="searchTerm"
    (input)="onSearchChange()"
  />
</div>

<div *ngIf="selectedIds.size > 1"class="bulk-actions-top">
  <button
    class="action-btn clear-btn"
    [title]="'Actions.ClearSelection' | translate"
    (click)="onClearSelection()"
  >
    <i class="fas fa-times"></i>
  </button>

  <button
    class="action-btn export-btn"
    [title]="'Actions.ExportSelected' | translate"
    (click)="onBulkExport()"
  >
    <i class="fas fa-file-export"></i>
  </button>

  <button
    class="action-btn delete-btn"
    [title]="'Actions.DeactivateSelected' | translate"
    (click)="onDeactivateSelected()"
  >
    <i class="fas fa-trash"></i>
  </button>

  <button
    class="action-btn"
    [title]="'Actions.ActivateSelected' | translate"
    (click)="onActivateSelected()"
  >
    <i class="fas fa-user-check"></i>
  </button>
</div>

<table class="custom-grid">
  <thead>
    <tr>
      <th *ngIf="config.checkboxSelection">
        <input
          type="checkbox"
          [checked]="selectAllCurrentPage"
          (change)="onSelectAllChange($event)"
        />
      </th>

      <th
        *ngFor="let col of config.columns"
        (click)="col.sortable && onSort(col.field)"
      >
        {{ col.header | translate }}
        <span *ngIf="sortColumn === col.field">
          {{ sortDirection === "asc" ? "▲" : "▼" }}
        </span>
      </th>

      <th *ngIf="config.actions?.length">
        {{ "Grid.Actions" | translate }}
      </th>
    </tr>
  </thead>

  <tbody>
    <tr
      *ngFor="let row of data"
      [ngClass]="config.rowClass ? config.rowClass(row) : ''"
    >
      <td *ngIf="config.checkboxSelection">
        <input
          type="checkbox"
          [checked]="selectedIds.has(row.id)"
          (change)="onSelectRowChange(row.id, $event)"
        />
      </td>

      <!-- Data Columns -->
      <td *ngFor="let col of config.columns">
        <ng-container *ngIf="col.template; else defaultCell">
          <ng-container
            *ngTemplateOutlet="col.template; context: { $implicit: row }"
          >
          </ng-container>
        </ng-container>
        <ng-template #defaultCell>
          {{ getCellValue(row, col.field) }}
        </ng-template>
      </td>

      <!-- Actions Column -->
      <td *ngIf="config.actions?.length">
        <button
          *ngFor="let action of config.actions"
          [ngClass]="['btn', getActionType(action, row)]"
          (click)="action.onClick(row)"
        >
          {{ getActionLabel(action, row) | translate }}
        </button>
      </td>
    </tr>
  </tbody>
</table>

<!-- Pagination -->
<div class="pagination">
  <button
    [disabled]="currentPage === 1"
    (click)="onPageChange(currentPage - 1)"
  >
    {{ "Grid.Prev" | translate }}
  </button>

  <span>
    {{ "Grid.Page" | translate }} {{ currentPage }} {{ "Grid.Of" | translate }}
    {{ Math.ceil(totalRecords / pageSize) }}
  </span>

  <button
    [disabled]="currentPage >= totalRecords / pageSize"
    (click)="onPageChange(currentPage + 1)"
  >
    {{ "Grid.Next" | translate }}
  </button>

  <!-- Page Size Dropdown -->
  <div class="page-size">
    <label>
      {{ "Grid.Show" | translate }}
      <select [(ngModel)]="pageSize" (change)="onPageSizeChange()">
        <option *ngFor="let size of config.pageSizeOptions" [value]="size">
          {{ size }}
        </option>
      </select>
    </label>
  </div>
</div>
